#! /bin/sh

# Ways to look at the data:
#  - totals over all cpus (current)
#  - average per call (for each cpu or summed over all cpus)
#  - also might want details on a particular hcall or set of hcalls only

: ${SYSFS:=/sys}
: ${DEBUGFS:=$SYSFS/kernel/debug}
: ${HCALL_INST:=$DEBUGFS/hcall_inst}


for cpu in $HCALL_INST/cpu*; do
	cat $cpu
done | awk '/^[^#]/ {
	calls[$1]      += $2;
	tb_total[$1]   += $3;
	purr_total[$1] += $4;
}
END {
	for (hcall in calls)
		print calls[hcall], "\t", tb_total[hcall], "\t", purr_total[hcall];
}'
