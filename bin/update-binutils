#! /bin/sh

die () {
	echo "$0: $*"
}

SRC_DIR="$HOME/g/binutils"

cd "$SRC_DIR" && git pull || die "Failed to pull new version"

BUILD_DIR=/tmp/build-binutils
rm -rf "$BUILD_DIR"
mkdir -p "$BUILD_DIR" && cd "$BUILD_DIR" || die "Could not create $BUILD_DIR"

PREFIX="$HOME/x-tools/multiarch"

BUILD_OPTS="--enable-targets=all --prefix=$PREFIX --enable-lto --with-sysroot --enable-languages=c,c++ --disable-nls"

"$SRC_DIR"/configure $BUILD_OPTS || die "Configure failed"

make -j4 || die "Build failed"

make install || die "Install failed"
